<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4CAF50">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ Sistema Financeiro</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --text-primary: #333333;
            --text-secondary: #666666;
            --income: #28a745;
            --expense: #dc3545;
            --accent: #4CAF50;
            --accent-hover: #45a049;
            --border: #dddddd;
            --card-bg: #ffffff;
            --shadow: rgba(0,0,0,0.1);
            --warning: #ff9800;
            --info: #2196F3;
        }

        .dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --accent: #5C6BC0;
            --accent-hover: #3f51b5;
            --border: #404040;
            --card-bg: #2d2d2d;
            --shadow: rgba(0,0,0,0.3);
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 10px 0;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            font-size: 24px;
            color: var(--text-primary);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-badge {
            background: var(--accent);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .dark-mode-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .dark-mode-toggle:hover {
            background: var(--accent);
            color: white;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 24px;
            border: 1px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .nav-tab.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .balance-card {
            background: linear-gradient(135deg, var(--accent), var(--accent-hover));
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 16px var(--shadow);
        }

        .balance-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .balance-value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .balance-breakdown {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px var(--shadow);
        }

        .stat-title {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .stat-sub {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .form-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px var(--shadow);
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-group input, 
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 16px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            border: 1px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .tab.active {
            color: white;
            border-color: currentColor;
        }

        .tab.income-tab.active {
            background: var(--income);
        }

        .tab.expense-tab.active {
            background: var(--expense);
        }

        
        .btn-secondary {
            padding: 10px 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            white-space: nowrap;
        }
        .btn-secondary:hover {
            filter: brightness(1.08);
        }
        .btn-small {
            padding: 8px 12px;
            font-size: 14px;
        }
        .relatorio-periodo input[type="date"],
        .relatorio-periodo select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

.btn-primary {
            width: 100%;
            padding: 14px;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-income {
            background: var(--income);
        }

        .btn-expense {
            background: var(--expense);
        }

        .btn-primary:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }

        .transactions-list {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px var(--shadow);
        }

        .list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
            gap: 15px;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-header {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 5px;
        }

        .transaction-valor {
            font-weight: bold;
            font-size: 18px;
        }

        .transaction-valor.income {
            color: var(--income);
        }

        .transaction-valor.expense {
            color: var(--expense);
        }

        .transaction-categoria {
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-size: 12px;
        }

        .transaction-conta {
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--info);
            color: white;
            font-size: 11px;
            opacity: 0.9;
        }

        .transaction-descricao {
            color: var(--text-primary);
            margin: 3px 0;
        }

        .transaction-detalhes {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .contas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .conta-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 6px var(--shadow);
            position: relative;
        }

        .conta-tipo {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            background: var(--info);
            color: white;
        }

        .conta-nome {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            padding-right: 60px;
        }

        .conta-saldo {
            font-size: 24px;
            color: var(--income);
            margin-bottom: 10px;
        }

        .orcamento-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .orcamento-select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 16px;
        }

        .orcamento-resumo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .orcamento-item {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .orcamento-header-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .relatorio-periodo {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .relatorio-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .relatorio-tabela {
            width: 100%;
            border-collapse: collapse;
        }

        .relatorio-tabela th,
        .relatorio-tabela td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .relatorio-tabela th {
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-weight: bold;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .import-export-section {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
            box-shadow: 0 4px 6px var(--shadow);
        }

        .import-export-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }

        .import-export-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .import-card, .export-card {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 25px;
        }

        .import-card h4, .export-card h4 {
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
        }

        .import-options, .export-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .export-btn {
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            background: var(--accent);
            color: white;
        }

        .export-btn:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }

        .import-btn {
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            background: #6c757d;
            color: white;
        }

        .import-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .txt-btn {
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            background: #17a2b8;
            color: white;
        }

        .txt-btn:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .planos-section {
            background: var(--card-bg);
            border-radius: 30px;
            padding: 40px 30px;
            margin: 40px 0;
            box-shadow: 0 10px 30px var(--shadow);
        }

        .planos-titulo {
            text-align: center;
            margin-bottom: 40px;
        }

        .planos-titulo h2 {
            font-size: 36px;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .planos-titulo p {
            color: var(--text-secondary);
            font-size: 18px;
        }

        .plano-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 50px;
        }

        .toggle-label {
            font-size: 18px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .economia-badge {
            background: gold;
            color: #333;
            padding: 5px 15px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 100px;
            height: 50px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--border);
            transition: .4s;
            border-radius: 50px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 42px;
            width: 42px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(50px);
        }

        .planilha-container {
            overflow-x: auto;
            margin: 30px 0;
            background: var(--card-bg);
            border-radius: 15px;
            padding: 5px;
        }

        .planilha-tabela {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .planilha-tabela th {
            background: var(--accent);
            color: white;
            padding: 20px 15px;
            font-size: 16px;
            text-align: center;
        }

        .planilha-tabela td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            text-align: center;
        }

        .planilha-tabela td.feature-name {
            text-align: left;
            font-weight: 500;
            background: var(--bg-secondary);
        }

        .planilha-tabela tr:hover td {
            background: var(--bg-secondary);
        }

        .preco-linha td {
            background: var(--bg-secondary);
            font-size: 18px;
            border-top: 2px solid var(--accent);
        }

        .economia {
            display: block;
            font-size: 12px;
            color: var(--income);
            margin-top: 5px;
        }

        .planilha-botoes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .plano-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .plano-btn:hover {
            filter: brightness(1.1);
            transform: scale(1.02);
        }

        .automacoes-info {
            background: var(--bg-secondary);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .automacoes-opcoes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .auto-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--card-bg);
            border-radius: 8px;
            cursor: pointer;
        }

        .auto-checkbox input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .pagamento-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .pagamento-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .pagamento-content h3 {
            color: var(--text-primary);
            margin-bottom: 20px;
        }

        .pagamento-content p {
            color: var(--text-secondary);
            margin: 10px 0;
        }

        .pagamento-opcoes {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 30px 0;
        }

        .pagamento-opcoes button {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .fechar-modal {
            background: var(--expense);
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }

        .bloqueio-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
        }

        .bloqueio-card {
            background: #2a2a40;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
            border-left: 5px solid #f44336;
        }

        .bloqueio-card h1 {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .bloqueio-card h2 {
            color: #f44336;
            margin-bottom: 15px;
        }

        .bloqueio-card p {
            color: #b0b0b0;
            margin-bottom: 20px;
        }

        .bloqueio-card button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: var(--accent);
        }
    </style>
</head>
<body>
    <div id="bloqueioScreen" style="display: none;">
        <div class="bloqueio-container">
            <div class="bloqueio-card">
                <h1>üîí</h1>
                <h2>Acesso Bloqueado</h2>
                <p id="bloqueioMsg">Sistema bloqueado pelo administrador.</p>
                <p style="font-size: 12px;">Entre em contato com o suporte.</p>
                <button onclick="window.location.reload()">Tentar novamente</button>
            </div>
        </div>
    </div>

    <div id="appContent" style="display: none;">
        <div class="container">
            <div class="header">
                <h1 id="empresaNome">üí∞ SISTEMA FINANCEIRO</h1>
                <div class="user-info">
                    <span class="user-badge" id="userBadge">üë§ Carregando...</span>
                    <button class="dark-mode-toggle" id="darkModeBtn" onclick="toggleDarkMode()">
                        üåô Modo Escuro
                    </button>
                </div>
            </div>

            <div class="nav-tabs" id="navTabs">
                <!-- Abas ser√£o geradas dinamicamente -->
            </div>

            <div id="dashboard" class="tab-content">
                <div class="balance-card">
                    <div class="balance-label">Saldo Total</div>
                    <div class="balance-value" id="saldoTotal">R$ 0,00</div>
                    <div class="balance-breakdown">
                        <span class="balance-income" id="totalReceitas" style="color: white;">üìà Receitas: R$ 0,00</span>
                        <span class="balance-expense" id="totalDespesas" style="color: white;">üìâ Despesas: R$ 0,00</span>
                        <span id="totalPrevisto">üìÖ Previsto: R$ 0,00</span>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title" id="statTitle1">üöö Entregas (M√™s)</div>
                        <div class="stat-value" id="statValue1">0</div>
                        <div class="stat-sub" id="statSub1">Meta: 0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title" id="statTitle2">üì¶ Motoristas ativos</div>
                        <div class="stat-value" id="statValue2">0</div>
                        <div class="stat-sub" id="statSub2">0 dispon√≠veis</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title" id="statTitle3">üí∞ Faturamento</div>
                        <div class="stat-value" id="statValue3">R$ 0,00</div>
                        <div class="stat-sub" id="statSub3">Meta: R$ 0,00</div>
                    </div>
                </div>
            </div>

            <div id="lancamentos" class="tab-content">
                <div class="tabs">
                    <button class="tab income-tab active" onclick="setTipoLancamento('receita')" id="btnReceita">üìà Receita (Entrada)</button>
                    <button class="tab expense-tab" onclick="setTipoLancamento('despesa')" id="btnDespesa">üìâ Despesa (Sa√≠da)</button>
                </div>

                <div class="form-card">
                    <div class="form-row">
                        <div class="form-group">
                            <label>üí∞ Valor (<span id="moedaSimbolo">R$</span>)</label>
                            <input type="text" id="valor" placeholder="0,00" value="500,00" onkeyup="formatarMoeda(this)">
                        </div>
                        <div class="form-group">
                            <label>üìÖ Data</label>
                            <input type="date" id="dataLancamento">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>üìù Descri√ß√£o</label>
                        <input type="text" id="descricao" placeholder="Ex: Entrega, Manuten√ß√£o" value="Entrega realizada">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>üìÇ Categoria</label>
                            <select id="categoria"></select>
                        </div>
                        <div class="form-group">
                            <label>üè¶ Conta</label>
                            <select id="contaSelect"></select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label id="labelMotorista">üöö Motorista (opcional)</label>
                        <input type="text" id="motorista" placeholder="Nome do motorista">
                    </div>

                    <div class="form-group">
                        <label>üìù Observa√ß√µes</label>
                        <textarea id="observacao" rows="2" placeholder="Detalhes adicionais..."></textarea>
                    </div>

                    <button class="btn-primary btn-income" onclick="lancarTransacao()" id="btnLancar">
                        ‚ûï LAN√áAR MOVIMENTO
                    </button>
                </div>

                <div class="transactions-list">
                    <div class="list-header">
                        <h3>üìã √öltimos Lan√ßamentos</h3>
                    </div>
                    <div id="listaLancamentos"></div>
                </div>
            </div>

            <div id="contas" class="tab-content">
                <div class="form-card">
                    <h3 style="margin-bottom: 20px;">‚ûï Nova Conta</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>üè¶ Nome da Conta</label>
                            <input type="text" id="nomeConta" placeholder="Ex: Conta transporte, Caixa" value="Conta Transportes">
                        </div>
                        <div class="form-group">
                            <label>üí∞ Saldo Inicial</label>
                            <input type="text" id="saldoInicial" value="5.000,00" onkeyup="formatarMoeda(this)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>üìÇ Tipo</label>
                            <select id="tipoConta">
                                <option value="corrente">üí≥ Corrente</option>
                                <option value="poupanca">üí∞ Poupan√ßa</option>
                                <option value="dinheiro">üíµ Caixa</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üé® Cor</label>
                            <input type="color" id="corConta" value="#4CAF50">
                        </div>
                    </div>
                    <button class="btn-primary btn-income" onclick="adicionarConta()">‚ûï ADICIONAR CONTA</button>
                </div>

                <div class="contas-grid" id="listaContas"></div>
            </div>

            <div id="orcamento" class="tab-content">
                <div class="orcamento-header">
                    <h3>üìÖ Or√ßamento Mensal</h3>
                    <input type="month" id="mesOrcamento" class="orcamento-select" onchange="carregarOrcamento()">
                </div>

                <div class="orcamento-resumo">
                    <div class="stat-card">
                        <div class="stat-title">üìà Receitas Previstas</div>
                        <div class="stat-value" id="totalReceitasPrevistas" style="color: var(--income);">R$ 0,00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">üìâ Despesas Previstas</div>
                        <div class="stat-value" id="totalDespesasPrevistas" style="color: var(--expense);">R$ 0,00</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">üí∞ Saldo Previsto</div>
                        <div class="stat-value" id="saldoPrevisto">R$ 0,00</div>
                    </div>
                </div>

                <div class="form-card">
                    <h4 style="margin-bottom: 15px;">‚ûï Nova Previs√£o</h4>
                    <div class="tabs">
                        <button class="tab income-tab active" onclick="setTipoPrevisao('receita')">üìà Receita</button>
                        <button class="tab expense-tab" onclick="setTipoPrevisao('despesa')">üìâ Despesa</button>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>üí∞ Valor</label>
                            <input type="text" id="valorPrevisto" placeholder="0,00" value="1.500,00" onkeyup="formatarMoeda(this)">
                        </div>
                        <div class="form-group">
                            <label>üìù Descri√ß√£o</label>
                            <input type="text" id="descricaoPrevista" placeholder="Ex: Contrato, Combust√≠vel" value="Contrato mensal">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>üìÇ Categoria</label>
                            <select id="categoriaPrevista"></select>
                        </div>
                        <div class="form-group">
                            <label>üìÖ Vencimento</label>
                            <input type="number" id="diaVencimento" min="1" max="31" placeholder="Dia" value="10">
                        </div>
                    </div>

                    <button class="btn-primary btn-income" onclick="adicionarPrevisao()">‚ûï ADICIONAR PREVIS√ÉO</button>
                </div>

                <div class="transactions-list">
                    <h4>üìã Previs√µes do M√™s</h4>
                    <div id="listaPrevisoes"></div>
                </div>
            </div>

            <div id="relatorios" class="tab-content">
                <div class="relatorio-periodo">
                    <select id="relatorioMes" onchange="gerarRelatorio()">
                        <option value="all">Todos os meses</option>
                    </select>
                    <select id="relatorioAno" onchange="gerarRelatorio()">
                        <option value="2026">2026</option>
                        <option value="2025">2025</option>
                        <option value="2024" selected>2024</option>
                    </select>

                    <input type="date" id="relatorioDataInicio" title="Data inicial" onchange="gerarRelatorio()">
                    <input type="date" id="relatorioDataFim" title="Data final" onchange="gerarRelatorio()">
                    <button class="btn-secondary btn-small" type="button" onclick="definirPeriodoRelatorio('mesAtual')">üìÖ Este m√™s</button>
                    <button class="btn-secondary btn-small" type="button" onclick="limparPeriodoRelatorio()">üßπ Limpar</button>
                    <button class="btn-primary btn-income" onclick="gerarRelatorio()">üìä GERAR RELAT√ìRIO</button>
                </div>

                <div class="import-export-section">
                    <div class="import-export-title">
                        <span>üîÑ</span> IMPORTAR / EXPORTAR DADOS
                    </div>
                    
                    <div class="import-export-grid">
                        <div class="import-card">
                            <h4>üì• IMPORTAR DADOS</h4>
                            <div class="import-options">
                                <button class="import-btn" onclick="importarCSV()">
                                    <span>üìÑ</span> Importar CSV
                                </button>
                                <button class="import-btn" onclick="importarTXT()">
                                    <span>üìÉ</span> Importar TXT
                                </button>
                                <button class="import-btn" onclick="importarJSON()">
                                    <span>üì¶</span> Importar JSON
                                </button>
                                <input type="file" id="fileInput" class="file-input" accept=".csv,.txt,.json">
                            </div>
                        </div>
                        
                        <div class="export-card">
                            <h4>üì§ EXPORTAR DADOS</h4>
                            <div class="export-options">
                                <button class="export-btn" onclick="exportarCSV()">
                                    <span>üìÑ</span> Exportar CSV
                                </button>
                                <button class="txt-btn" onclick="exportarTXT()">
                                    <span>üìÉ</span> Exportar TXT
                                </button>
                                <button class="export-btn" onclick="exportarJSON()">
                                    <span>üì¶</span> Exportar JSON
                                </button>
                                <button class="export-btn" onclick="exportarPDF()">
                                    <span>üìë</span> Exportar PDF
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="relatorio-card">
                    <h4 style="margin-bottom: 20px;">üìä Resumo do Per√≠odo</h4>
                    <div class="stats-grid" id="relatorioResumo"></div>
                </div>

                <div class="relatorio-card">
                    <h4 style="margin-bottom: 20px;">üìã Detalhamento por Categoria</h4>
                    <table class="relatorio-tabela" id="tabelaCategorias">
                        <thead>
                            <tr>
                                <th>Categoria</th>
                                <th>Receitas (Entradas)</th>
                                <th>Despesas (Sa√≠das)</th>
                                <th>Saldo</th>
                            </tr>
                        </thead>
                        <tbody id="corpoTabelaCategorias"></tbody>
                    </table>
                </div>
            </div>

            <div id="planos" class="tab-content">
                <div class="planos-section">
                    <div class="planos-titulo">
                        <h2>üí∞ PLANOS</h2>
                        <p>Solu√ß√µes completas para seu neg√≥cio</p>
                    </div>

                    <div class="plano-toggle">
                        <span class="toggle-label">üìÖ Mensal</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggleAnual" onchange="togglePlanos()">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label">üìÜ Anual <span class="economia-badge">ECONOMIZE 60%</span></span>
                    </div>

                    <div class="planilha-container">
                        <table class="planilha-tabela">
                            <thead>
                                <tr>
                                    <th>FUNCIONALIDADES</th>
                                    <th>üöö B√ÅSICO</th>
                                    <th>üì¶ PROFISSIONAL</th>
                                    <th>üè¢ EMPRESARIAL</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="feature-name">Usu√°rios</td>
                                    <td>1</td>
                                    <td>3</td>
                                    <td>10</td>
                                </tr>
                                <tr>
                                    <td class="feature-name">Transa√ß√µes/m√™s</td>
                                    <td>100</td>
                                    <td>500</td>
                                    <td>Ilimitado</td>
                                </tr>
                                <tr>
                                    <td class="feature-name">Relat√≥rios avan√ßados</td>
                                    <td>‚ùå</td>
                                    <td>‚úÖ</td>
                                    <td>‚úÖ</td>
                                </tr>
                                <tr>
                                    <td class="feature-name">Suporte priorit√°rio</td>
                                    <td>‚ùå</td>
                                    <td>‚ùå</td>
                                    <td>‚úÖ</td>
                                </tr>
                                <tr class="preco-linha">
                                    <td class="feature-name"><strong>PRE√áO MENSAL</strong></td>
                                    <td id="precoBasicoMensal"><strong>R$ 49,90</strong></td>
                                    <td id="precoProfissionalMensal"><strong>R$ 99,90</strong></td>
                                    <td id="precoEmpresarialMensal"><strong>R$ 199,90</strong></td>
                                </tr>
                                <tr class="preco-linha anual" style="display: none;">
                                    <td class="feature-name"><strong>PRE√áO ANUAL</strong></td>
                                    <td id="precoBasicoAnual"><strong>R$ 1.197,60</strong> <span class="economia">Economize 60%</span></td>
                                    <td id="precoProfissionalAnual"><strong>R$ 2.397,60</strong> <span class="economia">Economize 60%</span></td>
                                    <td id="precoEmpresarialAnual"><strong>R$ 4.797,60</strong> <span class="economia">Economize 60%</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="planilha-botoes">
                        <button class="plano-btn" style="background: #28a745;" onclick="selecionarPlano('basico')">
                            üöö ASSINAR B√ÅSICO
                        </button>
                        <button class="plano-btn" style="background: #17a2b8;" onclick="selecionarPlano('profissional')">
                            üì¶ ASSINAR PROFISSIONAL
                        </button>
                        <button class="plano-btn" style="background: #ffc107; color: #333;" onclick="selecionarPlano('empresarial')">
                            üè¢ ASSINAR EMPRESARIAL
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="modalPagamento" class="pagamento-modal">
            <div class="pagamento-content">
                <h3>üí∞ Finalizar assinatura</h3>
                <p id="planoEscolhido"></p>
                <p id="valorEscolhido" style="font-size: 24px; font-weight: bold; color: var(--accent);"></p>
                
                <div class="pagamento-opcoes">
                    <button style="background: #28a745;" onclick="simularPagamento('cartao')">
                        üí≥ Pagar com Cart√£o
                    </button>
                    <button style="background: #17a2b8;" onclick="simularPagamento('pix')">
                        üì± Pagar com PIX
                    </button>
                    <button style="background: #ffc107; color: #333;" onclick="simularPagamento('boleto')">
                        üìÑ Gerar Boleto
                    </button>
                </div>

                <button class="fechar-modal" onclick="fecharModal()">Fechar</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURA√á√ÉO FIREBASE (MESMA DO MASTER_APP)
        // ============================================
        const firebaseConfig = {
  apiKey: "AIzaSyArkRZLVVJNzx6I6GcWVF7NnjIkrF1jrcU",
  authDomain: "painelmastercomplet.firebaseapp.com",
  projectId: "painelmastercomplet",
  storageBucket: "painelmastercomplet.firebasestorage.app",
  messagingSenderId: "87580974705",
  appId: "1:87580974705:web:bd17f8609687f25ee4c5d0"
};

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ============================================
        // VARI√ÅVEIS GLOBAIS
        // ============================================
        let clienteId = null;
        let clienteConfig = null;
        let transacoes = [];
        let contas = [];
        let previsoes = [];
        let tipoLancamento = 'receita';
        let tipoPrevisao = 'receita';
        let automacoesAtivas = {};

        const categorias = {
            receita: ['Servi√ßos', 'Contratos', 'Frete', 'Entregas', 'Outros'],
            despesa: ['Combust√≠vel', 'Manuten√ß√£o', 'Pessoal', 'Alimenta√ß√£o', 'Viagem', 'Impostos', 'Outros']
        };

        // ============================================
        // CARREGAR CLIENTE DA URL
        // ============================================
        function getClienteIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('cliente');
        }

        // ============================================
        // CARREGAR CONFIGURA√á√ïES DO CLIENTE
        // ============================================
        // assinatura ativa do cliente (para n√£o criar v√°rios listeners)
        let unsubscribeCliente = null;
        let appInicializado = false;

        async function carregarConfigCliente() {
            clienteId = getClienteIdFromUrl();

            if (!clienteId) {
                document.body.innerHTML = `
                    <div class="bloqueio-container">
                        <div class="bloqueio-card" style="border-left-color: #ff9800;">
                            <h1>‚ö†Ô∏è</h1>
                            <h2>Cliente n√£o identificado</h2>
                            <p>URL inv√°lida. Use: appfinanceiro.html?cliente=ID_DO_CLIENTE</p>
                        </div>
                    </div>
                `;
                return;
            }

            // evita acumular listeners se a fun√ß√£o for chamada de novo
            if (unsubscribeCliente) {
                unsubscribeCliente();
                unsubscribeCliente = null;
            }

            try {
                const ref = db.collection('clientes').doc(clienteId);

                unsubscribeCliente = ref.onSnapshot(async (doc) => {
                    if (!doc.exists) {
                        document.body.innerHTML = `
                            <div class="bloqueio-container">
                                <div class="bloqueio-card" style="border-left-color: #ff9800;">
                                    <h1>‚ùì</h1>
                                    <h2>Cliente n√£o encontrado</h2>
                                    <p>O cliente solicitado n√£o existe no sistema.</p>
                                </div>
                            </div>
                        `;
                        return;
                    }

                    // ‚úÖ recebe config atualizada em tempo real
                    clienteConfig = { id: doc.id, ...doc.data() };

                    // bloqueio instant√¢neo
                    if (clienteConfig.status === 'bloqueado') {
                        document.getElementById('bloqueioScreen').style.display = 'block';
                        document.getElementById('bloqueioMsg').innerHTML =
                            `Sistema bloqueado pelo administrador.<br>Entre em contato para mais informa√ß√µes.`;
                        document.getElementById('appContent').style.display = 'none';
                        return;
                    }

                    // desbloqueado
                    document.getElementById('bloqueioScreen').style.display = 'none';
                    document.getElementById('appContent').style.display = 'block';

                    // aplica tema/termos/moeda etc. sempre que o master alterar
                    aplicarConfiguracoes();

                    // inicializa√ß√£o pesada s√≥ uma vez
                    if (!appInicializado) {
                        appInicializado = true;
                        await carregarDadosFinanceiros();
                        inicializarInterface();
                    } else {
                        // Se voc√™ quiser que as abas atualizem automaticamente quando o Master
                        // ligar/desligar fun√ß√µes, descomente a linha abaixo:
                        // inicializarInterface();
                    }
                }, (error) => {
                    console.error('Erro no onSnapshot:', error);
                    document.body.innerHTML = `
                        <div class="bloqueio-container">
                            <div class="bloqueio-card" style="border-left-color: #f44336;">
                                <h1>‚ùå</h1>
                                <h2>Erro de conex√£o</h2>
                                <p>N√£o foi poss√≠vel carregar os dados.</p>
                                <button onclick="window.location.reload()">Tentar novamente</button>
                            </div>
                        </div>
                    `;
                });

            } catch (error) {
                console.error('Erro ao iniciar sincroniza√ß√£o:', error);
                document.body.innerHTML = `
                    <div class="bloqueio-container">
                        <div class="bloqueio-card" style="border-left-color: #f44336;">
                            <h1>‚ùå</h1>
                            <h2>Erro de conex√£o</h2>
                            <p>N√£o foi poss√≠vel carregar os dados.</p>
                            <button onclick="window.location.reload()">Tentar novamente</button>
                        </div>
                    </div>
                `;
            }
        }


        // ============================================
        // APLICAR CONFIGURA√á√ïES DO CLIENTE
        // ============================================
        function aplicarConfiguracoes() {
            if (!clienteConfig) return;

            // Nome da empresa
            document.getElementById('empresaNome').innerHTML = `üí∞ ${clienteConfig.nome || 'SISTEMA FINANCEIRO'}`;
            document.getElementById('userBadge').innerHTML = `üë§ ${clienteConfig.nome || 'Empresa'}`;

            // Cor principal
            if (clienteConfig.cor) {
                document.documentElement.style.setProperty('--accent', clienteConfig.cor);
                document.documentElement.style.setProperty('--accent-hover', adjustColor(clienteConfig.cor, -20));
            }

            // Termos personalizados
            if (clienteConfig.termoColaborador) {
                document.getElementById('labelMotorista').innerHTML = `üöö ${clienteConfig.termoColaborador} (opcional)`;
                document.getElementById('motorista').placeholder = `Nome do ${clienteConfig.termoColaborador.toLowerCase()}`;
                document.getElementById('statTitle2').innerHTML = `üì¶ ${clienteConfig.termoColaborador}s ativos`;
            }

            if (clienteConfig.termoAcao) {
                document.getElementById('statTitle1').innerHTML = `üöö ${clienteConfig.termoAcao}s (M√™s)`;
            }

            if (clienteConfig.termoCliente) {
                // Pode usar em algum lugar
            }

            // Moeda
            if (clienteConfig.moeda) {
                const simbolos = {
                    'BRL': 'R$',
                    'USD': '$',
                    'EUR': '‚Ç¨'
                };
                document.getElementById('moedaSimbolo').innerHTML = simbolos[clienteConfig.moeda] || 'R$';
            }

            // Modo escuro
            if (clienteConfig.modoEscuro === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeBtn').innerHTML = '‚òÄÔ∏è Modo Claro';
            } else if (clienteConfig.modoEscuro === 'light') {
                document.body.classList.remove('dark-mode');
                document.getElementById('darkModeBtn').innerHTML = 'üåô Modo Escuro';
            }
        }

        // ============================================
        // CARREGAR DADOS FINANCEIROS DO CLIENTE
        // ============================================
        async function carregarDadosFinanceiros() {
            try {
                // Tentar carregar dados existentes
                const docRef = db.collection('dados_financeiros').doc(clienteId);
                const doc = await docRef.get();
                
                if (doc.exists) {
                    const dados = doc.data();
                    transacoes = dados.transacoes || [];
                    contas = dados.contas || [];
                    previsoes = dados.previsoes || [];
                } else {
                    // Criar dados iniciais
                    transacoes = [];
                    contas = [];
                    previsoes = [];
                    
                    // Salvar estrutura inicial
                    await docRef.set({
                        transacoes: [],
                        contas: [],
                        previsoes: [],
                        criadoEm: new Date().toISOString()
                    });
                }
            } catch (error) {
                console.error('Erro ao carregar dados financeiros:', error);
            }
        }

        // ============================================
        // SALVAR DADOS FINANCEIROS
        // ============================================
        async function salvarDadosFinanceiros() {
            try {
                await db.collection('dados_financeiros').doc(clienteId).set({
                    transacoes: transacoes,
                    contas: contas,
                    previsoes: previsoes,
                    atualizadoEm: new Date().toISOString()
                }, { merge: true });
                return true;
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
                return false;
            }
        }

        // ============================================
        // INICIALIZAR INTERFACE
        // ============================================
        function inicializarInterface() {
            // Construir abas baseado nas fun√ß√µes ativas
            const navTabs = document.getElementById('navTabs');
            navTabs.innerHTML = '';

            const abas = [
                { id: 'dashboard', nome: 'üìä Dashboard', ativo: clienteConfig.funcDashboard !== false },
                { id: 'lancamentos', nome: 'üìù Lan√ßamentos', ativo: clienteConfig.funcLancamentos !== false },
                { id: 'contas', nome: 'üè¶ Contas', ativo: clienteConfig.funcContas !== false },
                { id: 'orcamento', nome: 'üìÖ Or√ßamento', ativo: clienteConfig.funcOrcamento !== false },
                { id: 'relatorios', nome: 'üìà Relat√≥rios', ativo: clienteConfig.funcRelatorios !== false },
                { id: 'planos', nome: 'üí∞ Planos', ativo: clienteConfig.funcPlanos === true }
            ];

            let primeiraAbaAtiva = null;

            abas.forEach(aba => {
                if (aba.ativo) {
                    const btn = document.createElement('button');
                    btn.className = `nav-tab ${!primeiraAbaAtiva ? 'active' : ''}`;
                    btn.setAttribute('onclick', `showTab('${aba.id}')`);
                    btn.innerHTML = aba.nome;
                    navTabs.appendChild(btn);
                    
                    if (!primeiraAbaAtiva) {
                        primeiraAbaAtiva = aba.id;
                    }
                } else {
                    // Esconder a aba se n√£o estiver ativa
                    const tab = document.getElementById(aba.id);
                    if (tab) tab.style.display = 'none';
                }
            });

            // Se n√£o tem planos, esconder se√ß√£o de importa√ß√£o tamb√©m?
            if (clienteConfig.funcImportar === false) {
                const importSection = document.querySelector('.import-export-section');
                if (importSection) importSection.style.display = 'none';
            }

            // Mostrar primeira aba
            if (primeiraAbaAtiva) {
                showTab(primeiraAbaAtiva);
            }

            // Configurar datas
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataLancamento').value = hoje;
            
            const mesAtual = `${new Date().getFullYear()}-${String(new Date().getMonth() + 1).padStart(2, '0')}`;
            document.getElementById('mesOrcamento').value = mesAtual;

            // Preencher selects
            preencherCategorias();
            preencherSelectContas();
            preencherCategoriasPrevisao();
            preencherSelectMeses();

            // Atualizar dados
            atualizarDashboard();
            atualizarListaLancamentos();
            atualizarListaContas();
            carregarOrcamento();
            gerarRelatorio();
        }

        // ============================================
        // FUN√á√ïES AUXILIARES
        // ============================================
        function adjustColor(hex, percent) {
            // Simplificado - escurecer/clarear cor
            return hex;
        }

        function formatarMoeda(input) {
            let valor = input.value.replace(/\D/g, '');
            if (valor === '') {
                input.value = '';
                return;
            }
            valor = parseInt(valor) / 100;
            input.value = valor.toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function converterMoedaParaNumber(valorString) {
            if (!valorString) return 0;
            const valorLimpo = valorString.replace(/\./g, '').replace(',', '.');
            return parseFloat(valorLimpo) || 0;
        }

        // ============================================
        // FUN√á√ïES DE NAVEGA√á√ÉO
        // ============================================
        function showTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function setTipoLancamento(tipo) {
            tipoLancamento = tipo;
            document.querySelectorAll('#lancamentos .tab').forEach(t => t.classList.remove('active'));
            
            if (tipo === 'receita') {
                document.querySelector('#lancamentos .income-tab').classList.add('active');
                document.getElementById('btnLancar').classList.remove('btn-expense');
                document.getElementById('btnLancar').classList.add('btn-income');
            } else {
                document.querySelector('#lancamentos .expense-tab').classList.add('active');
                document.getElementById('btnLancar').classList.remove('btn-income');
                document.getElementById('btnLancar').classList.add('btn-expense');
            }
            preencherCategorias();
        }

        function setTipoPrevisao(tipo) {
            tipoPrevisao = tipo;
            document.querySelectorAll('#orcamento .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            preencherCategoriasPrevisao();
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const btn = document.querySelector('.dark-mode-toggle');
            
            if (document.body.classList.contains('dark-mode')) {
                btn.textContent = '‚òÄÔ∏è Modo Claro';
            } else {
                btn.textContent = 'üåô Modo Escuro';
            }
        }

        // ============================================
        // FUN√á√ïES DE LAN√áAMENTOS
        // ============================================
        function preencherCategorias() {
            const select = document.getElementById('categoria');
            if (!select) return;
            
            select.innerHTML = '';
            categorias[tipoLancamento].forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
        }

        function preencherSelectContas() {
            const select = document.getElementById('contaSelect');
            if (!select) return;
            
            select.innerHTML = '';
            contas.forEach(conta => {
                const option = document.createElement('option');
                option.value = conta.id;
                option.textContent = `${conta.nome} (${conta.tipo})`;
                select.appendChild(option);
            });
        }

        async function lancarTransacao() {
            const valorInput = document.getElementById('valor').value;
            const descricao = document.getElementById('descricao').value;
            const categoria = document.getElementById('categoria').value;
            const contaId = parseInt(document.getElementById('contaSelect').value);
            const motorista = document.getElementById('motorista')?.value || '';
            const observacao = document.getElementById('observacao').value;
            let data = document.getElementById('dataLancamento').value;

            if (!contas.length) {
                alert('‚ö†Ô∏è Cadastre uma conta primeiro!');
                showTab('contas');
                return;
            }

            const valorNumerico = converterMoedaParaNumber(valorInput);

            if (!valorNumerico || valorNumerico <= 0) {
                alert('Digite um valor v√°lido!');
                return;
            }

            if (!descricao) {
                alert('Digite uma descri√ß√£o!');
                return;
            }

            if (!data) {
                data = new Date().toISOString().split('T')[0];
            }

            const novaTransacao = {
                id: Date.now(),
                tipo: tipoLancamento,
                valor: valorNumerico,
                descricao: descricao,
                categoria: categoria,
                contaId: contaId,
                motorista: motorista,
                observacao: observacao,
                data: data
            };

            transacoes.unshift(novaTransacao);
            await salvarDadosFinanceiros();
            
            atualizarListaLancamentos();
            atualizarDashboard();
            
            document.getElementById('valor').value = '';
            document.getElementById('descricao').value = '';
            document.getElementById('observacao').value = '';
            document.getElementById('motorista').value = '';
            document.getElementById('dataLancamento').value = new Date().toISOString().split('T')[0];
            
            alert('‚úÖ Lan√ßamento realizado!');
        }

        function atualizarListaLancamentos() {
            const listaDiv = document.getElementById('listaLancamentos');
            if (!listaDiv) return;

            if (transacoes.length === 0) {
                listaDiv.innerHTML = '<div class="empty-state">üïí Nenhum lan√ßamento</div>';
                return;
            }

            let html = '';
            transacoes.slice(0, 15).forEach(t => {
                const conta = contas.find(c => c.id === t.contaId) || { nome: 'Conta' };
                const valorFormatado = t.valor.toFixed(2).replace('.', ',');
                const termoColaborador = clienteConfig?.termoColaborador || 'Motorista';
                
                html += `
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="transaction-header">
                                <span class="transaction-valor ${t.tipo === 'receita' ? 'income' : 'expense'}">
                                    ${t.tipo === 'receita' ? '+' : '-'} R$ ${valorFormatado}
                                </span>
                                <span class="transaction-categoria">${t.categoria}</span>
                                <span class="transaction-conta">${conta.nome}</span>
                                ${t.motorista ? `<span class="transaction-categoria">üöö ${t.motorista}</span>` : ''}
                            </div>
                            <div class="transaction-descricao">${t.descricao}</div>
                            <div class="transaction-detalhes">
                                üìÖ ${new Date(t.data).toLocaleDateString('pt-BR')}
                                ${t.observacao ? `<br>üìå ${t.observacao}` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });

            listaDiv.innerHTML = html;
        }

        // ============================================
        // FUN√á√ïES DE CONTAS
        // ============================================
        async function adicionarConta() {
            const nome = document.getElementById('nomeConta').value;
            const saldoInicialInput = document.getElementById('saldoInicial').value;
            const saldoInicial = converterMoedaParaNumber(saldoInicialInput) || 0;
            const tipo = document.getElementById('tipoConta').value;
            const cor = document.getElementById('corConta').value;

            if (!nome) {
                alert('Digite um nome para a conta!');
                return;
            }

            const novaConta = {
                id: Date.now(),
                nome: nome,
                tipo: tipo,
                saldoInicial: saldoInicial,
                cor: cor
            };

            contas.push(novaConta);
            await salvarDadosFinanceiros();
            
            document.getElementById('nomeConta').value = '';
            document.getElementById('saldoInicial').value = '0,00';
            
            atualizarListaContas();
            preencherSelectContas();
        }

        function atualizarListaContas() {
            const listaDiv = document.getElementById('listaContas');
            if (!listaDiv) return;

            if (contas.length === 0) {
                listaDiv.innerHTML = '<div class="empty-state">üè¶ Nenhuma conta cadastrada</div>';
                return;
            }

            let html = '';
            contas.forEach(conta => {
                const saldo = calcularSaldoConta(conta.id) + (conta.saldoInicial || 0);
                const saldoFormatado = saldo.toFixed(2).replace('.', ',');
                
                html += `
                    <div class="conta-card" style="border-left: 4px solid ${conta.cor}">
                        <span class="conta-tipo">${conta.tipo}</span>
                        <div class="conta-nome">${conta.nome}</div>
                        <div class="conta-saldo">R$ ${saldoFormatado}</div>
                    </div>
                `;
            });

            listaDiv.innerHTML = html;
        }

        function calcularSaldoConta(contaId) {
            return transacoes
                .filter(t => t.contaId === contaId)
                .reduce((total, t) => {
                    return total + (t.tipo === 'receita' ? t.valor : -t.valor);
                }, 0);
        }

        // ============================================
        // FUN√á√ïES DE OR√áAMENTO
        // ============================================
        function preencherCategoriasPrevisao() {
            const select = document.getElementById('categoriaPrevista');
            if (!select) return;
            
            select.innerHTML = '';
            categorias[tipoPrevisao].forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
        }

        async function adicionarPrevisao() {
            const mes = document.getElementById('mesOrcamento').value;
            const valorInput = document.getElementById('valorPrevisto').value;
            const valor = converterMoedaParaNumber(valorInput);
            const descricao = document.getElementById('descricaoPrevista').value;
            const categoria = document.getElementById('categoriaPrevista').value;
            const dia = document.getElementById('diaVencimento').value;

            if (!mes) {
                alert('Selecione o m√™s!');
                return;
            }

            if (!valor || valor <= 0) {
                alert('Digite um valor v√°lido!');
                return;
            }

            if (!descricao) {
                alert('Digite uma descri√ß√£o!');
                return;
            }

            const novaPrevisao = {
                id: Date.now(),
                mes: mes,
                tipo: tipoPrevisao,
                valor: valor,
                descricao: descricao,
                categoria: categoria,
                dia: dia || 1
            };

            previsoes.push(novaPrevisao);
            await salvarDadosFinanceiros();
            
            document.getElementById('valorPrevisto').value = '';
            document.getElementById('descricaoPrevista').value = '';
            document.getElementById('diaVencimento').value = '';
            carregarOrcamento();
        }

        function carregarOrcamento() {
            const mes = document.getElementById('mesOrcamento').value;
            if (!mes) return;

            const previsoesMes = previsoes.filter(p => p.mes === mes);

            let totalReceitas = 0;
            let totalDespesas = 0;

            previsoesMes.forEach(p => {
                if (p.tipo === 'receita') totalReceitas += p.valor;
                else totalDespesas += p.valor;
            });

            document.getElementById('totalReceitasPrevistas').innerHTML = `R$ ${totalReceitas.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalDespesasPrevistas').innerHTML = `R$ ${totalDespesas.toFixed(2).replace('.', ',')}`;
            document.getElementById('saldoPrevisto').innerHTML = `R$ ${(totalReceitas - totalDespesas).toFixed(2).replace('.', ',')}`;

            const listaDiv = document.getElementById('listaPrevisoes');
            if (!listaDiv) return;

            if (previsoesMes.length === 0) {
                listaDiv.innerHTML = '<div class="empty-state">üìÖ Nenhuma previs√£o para este m√™s</div>';
                return;
            }

            let html = '';
            previsoesMes.sort((a, b) => a.dia - b.dia).forEach(p => {
                const valorFormatado = p.valor.toFixed(2).replace('.', ',');
                html += `
                    <div class="orcamento-item">
                        <div class="orcamento-header-item">
                            <span style="color: ${p.tipo === 'receita' ? 'var(--income)' : 'var(--expense)'}">
                                ${p.tipo === 'receita' ? 'üìà' : 'üìâ'} R$ ${valorFormatado}
                            </span>
                            <span>Dia ${p.dia}</span>
                        </div>
                        <div><strong>${p.descricao}</strong></div>
                        <div style="font-size: 12px;">${p.categoria}</div>
                    </div>
                `;
            });

            listaDiv.innerHTML = html;
        }

        // ============================================
        // FUN√á√ïES DE DASHBOARD
        // ============================================
        function atualizarDashboard() {
            let totalReceitas = 0;
            let totalDespesas = 0;

            transacoes.forEach(t => {
                if (t.tipo === 'receita') totalReceitas += t.valor;
                else totalDespesas += t.valor;
            });

            document.getElementById('saldoTotal').innerHTML = `R$ ${(totalReceitas - totalDespesas).toFixed(2).replace('.', ',')}`;
            document.getElementById('totalReceitas').innerHTML = `üìà Receitas: R$ ${totalReceitas.toFixed(2).replace('.', ',')}`;
            document.getElementById('totalDespesas').innerHTML = `üìâ Despesas: R$ ${totalDespesas.toFixed(2).replace('.', ',')}`;

            let saldoContas = 0;
            contas.forEach(conta => {
                saldoContas += calcularSaldoConta(conta.id) + (conta.saldoInicial || 0);
            });
            
            document.getElementById('statValue3').innerHTML = `R$ ${saldoContas.toFixed(2).replace('.', ',')}`;
            document.getElementById('statSub3').innerHTML = `${contas.length} contas ativas`;

            // Estat√≠sticas simuladas
            document.getElementById('statValue1').innerHTML = '342';
            document.getElementById('statSub1').innerHTML = 'Meta: 400';
            document.getElementById('statValue2').innerHTML = '12';
            document.getElementById('statSub2').innerHTML = '3 dispon√≠veis';
        }

        // ============================================
        // FUN√á√ïES DE RELAT√ìRIOS
        // ============================================
        function preencherSelectMeses() {
            const selectMes = document.getElementById('relatorioMes');
            if (selectMes) {
                selectMes.innerHTML = '<option value="all">Todos os meses</option>';
                const meses = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                meses.forEach((mes, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = mes;
                    selectMes.appendChild(option);
                });
            }
        }


        function definirPeriodoRelatorio(tipo) {
            const hoje = new Date();
            const inicio = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            const fim = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);

            if (tipo === 'mesAtual') {
                document.getElementById('relatorioDataInicio').value = inicio.toISOString().slice(0, 10);
                document.getElementById('relatorioDataFim').value = fim.toISOString().slice(0, 10);
            }
            gerarRelatorio();
        }

        function limparPeriodoRelatorio() {
            const di = document.getElementById('relatorioDataInicio');
            const df = document.getElementById('relatorioDataFim');
            if (di) di.value = '';
            if (df) df.value = '';
            gerarRelatorio();
        }



        function gerarRelatorio() {
            const mes = document.getElementById('relatorioMes').value;
            const ano = parseInt(document.getElementById('relatorioAno').value);

            const dataInicioStr = document.getElementById('relatorioDataInicio')?.value || '';
            const dataFimStr = document.getElementById('relatorioDataFim')?.value || '';

            const temPeriodo = !!dataInicioStr || !!dataFimStr;

            let dataInicio = null;
            let dataFim = null;

            if (dataInicioStr) dataInicio = new Date(dataInicioStr + 'T00:00:00');
            if (dataFimStr) dataFim = new Date(dataFimStr + 'T23:59:59.999');

            let transacoesFiltradas = transacoes.filter(t => {
                const data = new Date(t.data);

                // Se o usu√°rio escolheu um per√≠odo (de/at√©), usamos esse filtro e ignoramos m√™s/ano
                if (temPeriodo) {
                    if (dataInicio && data < dataInicio) return false;
                    if (dataFim && data > dataFim) return false;
                    return true;
                }

                // Caso contr√°rio, segue o filtro cl√°ssico por ano/m√™s
                return data.getFullYear() === ano && (mes === 'all' || data.getMonth() === parseInt(mes));
            });

            let totalReceitas = 0;
            let totalDespesas = 0;
            let porCategoria = {};

            transacoesFiltradas.forEach(t => {
                if (t.tipo === 'receita') totalReceitas += t.valor;
                else totalDespesas += t.valor;

                if (!porCategoria[t.categoria]) {
                    porCategoria[t.categoria] = { receitas: 0, despesas: 0 };
                }
                
                if (t.tipo === 'receita') {
                    porCategoria[t.categoria].receitas += t.valor;
                } else {
                    porCategoria[t.categoria].despesas += t.valor;
                }
            });

            const resumoDiv = document.getElementById('relatorioResumo');
            if (resumoDiv) {
                resumoDiv.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-title">üìà Total Receitas</div>
                        <div class="stat-value" style="color: var(--income)">R$ ${totalReceitas.toFixed(2).replace('.', ',')}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">üìâ Total Despesas</div>
                        <div class="stat-value" style="color: var(--expense)">R$ ${totalDespesas.toFixed(2).replace('.', ',')}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">üí∞ Saldo do Per√≠odo</div>
                        <div class="stat-value">R$ ${(totalReceitas - totalDespesas).toFixed(2).replace('.', ',')}</div>
                    </div>
                `;
            }

            const tbody = document.getElementById('corpoTabelaCategorias');
            if (tbody) {
                let html = '';
                for (let cat in porCategoria) {
                    const saldo = porCategoria[cat].receitas - porCategoria[cat].despesas;
                    html += `
                        <tr>
                            <td>${cat}</td>
                            <td style="color: var(--income)">R$ ${porCategoria[cat].receitas.toFixed(2).replace('.', ',')}</td>
                            <td style="color: var(--expense)">R$ ${porCategoria[cat].despesas.toFixed(2).replace('.', ',')}</td>
                            <td style="color: ${saldo >= 0 ? 'var(--income)' : 'var(--expense)'}">
                                R$ ${saldo.toFixed(2).replace('.', ',')}
                            </td>
                        </tr>
                    `;
                }
                tbody.innerHTML = html;
            }
        }

        // ============================================
        // FUN√á√ïES DE IMPORTA√á√ÉO/EXPORTA√á√ÉO
        // ============================================
        function importarCSV() { alert('üì• Importa√ß√£o CSV'); }
        function importarTXT() { alert('üì• Importa√ß√£o TXT'); }
        function importarJSON() { alert('üì• Importa√ß√£o JSON'); }
        function exportarCSV() { alert('üì§ Exporta√ß√£o CSV'); }
        function exportarJSON() { alert('üì§ Exporta√ß√£o JSON'); }
        
        function exportarTXT() {
            try {
                let conteudo = `=== RELAT√ìRIO ${clienteConfig?.nome?.toUpperCase()} ===\n`;
                conteudo += `Data: ${new Date().toLocaleDateString('pt-BR')}\n`;
                conteudo += "=".repeat(50) + "\n\n";
                
                let totalReceitas = 0, totalDespesas = 0;
                transacoes.forEach(t => {
                    if (t.tipo === 'receita') totalReceitas += t.valor;
                    else totalDespesas += t.valor;
                });
                
                conteudo += "üìä RESUMO GERAL\n";
                conteudo += `Receitas: R$ ${totalReceitas.toFixed(2).replace('.', ',')}\n`;
                conteudo += `Despesas: R$ ${totalDespesas.toFixed(2).replace('.', ',')}\n`;
                conteudo += `Saldo: R$ ${(totalReceitas - totalDespesas).toFixed(2).replace('.', ',')}\n\n`;
                
                conteudo += "üìù √öLTIMAS TRANSA√á√ïES\n";
                conteudo += "-".repeat(50) + "\n";
                transacoes.slice(0, 20).forEach(t => {
                    const data = new Date(t.data).toLocaleDateString('pt-BR');
                    const valor = t.valor.toFixed(2).replace('.', ',');
                    conteudo += `${data} | ${t.descricao} | ${t.tipo === 'receita' ? '+' : '-'} R$ ${valor}\n`;
                });
                
                const blob = new Blob([conteudo], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${clienteConfig?.nome || 'relatorio'}_${new Date().toISOString().slice(0,10)}.txt`;
                a.click();
                URL.revokeObjectURL(url);
                
                alert('‚úÖ Arquivo TXT exportado!');
            } catch (error) {
                alert('‚ùå Erro ao exportar TXT');
            }
        }

        function exportarPDF() {
            const janela = window.open('', '_blank');
            const hoje = new Date().toLocaleDateString('pt-BR');
            
            let totalReceitas = 0, totalDespesas = 0;
            transacoes.forEach(t => {
                if (t.tipo === 'receita') totalReceitas += t.valor;
                else totalDespesas += t.valor;
            });
            
            const html = `
            <html>
            <head>
                <title>Relat√≥rio ${clienteConfig?.nome || 'Financeiro'}</title>
                <style>
                    body { font-family: Arial; padding: 20px; }
                    h1 { color: ${clienteConfig?.cor || '#333'}; }
                    .receita { color: #28a745; }
                    .despesa { color: #dc3545; }
                    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                    th { background: #f5f5f5; padding: 10px; }
                    td { padding: 10px; border-bottom: 1px solid #ddd; }
                </style>
            </head>
            <body>
                <h1>üìä ${clienteConfig?.nome || 'Relat√≥rio Financeiro'}</h1>
                <p>Gerado em: ${hoje}</p>
                
                <h3>Resumo</h3>
                <p class="receita">Receitas: R$ ${totalReceitas.toFixed(2).replace('.', ',')}</p>
                <p class="despesa">Despesas: R$ ${totalDespesas.toFixed(2).replace('.', ',')}</p>
                <p>Saldo: R$ ${(totalReceitas - totalDespesas).toFixed(2).replace('.', ',')}</p>
                
                <h3>√öltimas movimenta√ß√µes</h3>
                <table>
                    <tr><th>Data</th><th>Descri√ß√£o</th><th>Valor</th></tr>
                    ${transacoes.slice(0, 10).map(t => `
                        <tr>
                            <td>${new Date(t.data).toLocaleDateString('pt-BR')}</td>
                            <td>${t.descricao}</td>
                            <td class="${t.tipo === 'receita' ? 'receita' : 'despesa'}">
                                R$ ${t.valor.toFixed(2).replace('.', ',')}
                            </td>
                        </tr>
                    `).join('')}
                </table>
                <p><button onclick="window.print()">Imprimir</button></p>
            </body>
            </html>
            `;
            
            janela.document.write(html);
            janela.document.close();
        }

        // ============================================
        // FUN√á√ïES DOS PLANOS
        // ============================================
        function togglePlanos() {
            const isAnual = document.getElementById('toggleAnual').checked;
            document.querySelectorAll('.preco-linha').forEach(linha => {
                if (linha.classList.contains('anual')) {
                    linha.style.display = isAnual ? 'table-row' : 'none';
                } else {
                    linha.style.display = isAnual ? 'none' : 'table-row';
                }
            });
        }

        function selecionarPlano(plano) {
            let nomePlano = {
                'basico': 'B√°sico',
                'profissional': 'Profissional',
                'empresarial': 'Empresarial'
            }[plano] || plano;
            
            const isAnual = document.getElementById('toggleAnual').checked;
            const periodo = isAnual ? 'anual' : 'mensal';
            
            let valor = 0;
            if (plano === 'basico') valor = isAnual ? 1197.60 : 49.90;
            if (plano === 'profissional') valor = isAnual ? 2397.60 : 99.90;
            if (plano === 'empresarial') valor = isAnual ? 4797.60 : 199.90;
            
            document.getElementById('planoEscolhido').innerHTML = 
                `<strong>Plano:</strong> ${nomePlano} (${periodo})`;
            document.getElementById('valorEscolhido').innerHTML = 
                `R$ ${valor.toFixed(2).replace('.', ',')}`;
            
            document.getElementById('modalPagamento').style.display = 'flex';
        }

        function simularPagamento(tipo) {
            alert(`‚úÖ Pagamento ${tipo} simulado! (Modo demonstra√ß√£o)`);
            fecharModal();
        }

        function fecharModal() {
            document.getElementById('modalPagamento').style.display = 'none';
        }

        // ============================================
        // INICIALIZA√á√ÉO
        // ============================================
        window.onload = function() {
            carregarConfigCliente();
        };
    </script>
</body>
</html>
